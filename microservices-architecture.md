# Архитектура микросервисного приложения с распределенной обработкой гифок

## Общая структура проекта

```
giphy-microservices/
│
├── api-service/            # Сервис API
├── storage-service/        # Сервис работы с базой данных и внешними API
├── file-storage-service/   # Сервис для сохранения файлов в S3
│
├── internal/               # Общие внутренние модули
│   ├── domain/             # Доменные модели и бизнес-логика
│   ├── infrastructure/     # Реализация инфраструктурных компонентов
│   └── pkg/                # Общие утилиты
│
├── configs/                # Конфигурационные файлы
├── deployments/            # Docker, Kubernetes конфигурации
└── scripts/                # Вспомогательные скрипты
```

## Принципы DDD-подхода

### 1. Выделение доменных сущностей

- Gif (доменная модель гифки)
- Request (модель запроса)
- Cache (модель кэширования)

### 2. Bounded Contexts

- Каждый микросервис представляет отдельный bounded context
- Четкое разделение ответственности между сервисами

## Технологический стек

### Основные технологии

- Golang 1.21+
- gRPC
- Kafka
- PostgreSQL
- Redis
- S3 (Minio/AWS S3)
- Docker, Docker Compose

### Библиотеки и фреймворки

- web: gin/echo
- orm: gorm
- grpc: grpc-go
- kafka: segmentio/kafka-go
- redis: go-redis
- s3: aws-sdk-go
- metrics: prometheus
- tracing: jaeger/opentelemetry
- logging: zap/logrus

## Архитектурные компоненты

### API Service

- Входная точка приложения
- Обработка HTTP-запросов
- Кэширование в Redis
- Взаимодействие с Storage Service через gRPC

### Storage Service

- Работа с PostgreSQL
- Интеграция с Giphy API
- Публикация событий в Kafka

### File Storage Service

- Потребление сообщений из Kafka
- Сохранение файлов в S3

## Observability

### Метрики

- Prometheus для сбора метрик
- Мониторинг производительности
- Отслеживание количества запросов
- Трекинг времени обработки

### Распределенный трейсинг

- OpenTelemetry
- Jaeger для визуализации трасс
- Сквозная трассировка между сервисами

### Логирование

- Структурированное логирование
- Уровни: info, warn, error
- Centralized logging (ELK/Grafana Loki)

## Подготовительные шаги

1. Определение доменных моделей
2. Проектирование контрактов gRPC
3. Настройка инфраструктурных компонентов
4. Реализация адаптеров и репозиториев
5. Имплементация бизнес-логики
6. Настройка мониторинга и логирования

## Рекомендации по разработке

- Использовать dependency injection
- Придерживаться принципов SOLID
- Разделять инфраструктурный и доменный код
- Создавать юнит и интеграционные тесты
- Использовать makefile для автоматизации

## Конфигурация и деплой

- Docker Compose для локальной разработки
- Kubernetes для продакшен среды
- Helm charts для управления деплоем
- CI/CD pipeline (GitHub Actions/GitLab CI)
